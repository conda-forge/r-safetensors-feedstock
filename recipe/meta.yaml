{% set version = "0.2.0" %}
{% set posix = 'm2-' if win else '' %}

package:
  name: r-safetensors
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/safetensors_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/safetensors/safetensors_{{ version }}.tar.gz
  sha256: 2cfd525fd3ffa0da637206f125370a3481a48749529e6405a7583d94d5af5006

build:
  number: 0
  noarch: generic
  rpaths:
    - lib/R/lib/
    - lib/

requirements:
  build:
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
    - r-r6
    - r-cli
    - r-jsonlite
    - r-rlang
  run:
    - r-base
    - r-r6
    - r-cli
    - r-jsonlite
    - r-rlang

test:
  commands:
    - $R -e "library('safetensors')"           # [not win]
    - "\"%R%\" -e \"library('safetensors')\""  # [win]

about:
  home: https://mlverse.github.io/safetensors/
  dev_url: https://github.com/mlverse/safetensors
  license: MIT
  summary: A file format for storing tensors that is secure (doesn't allow for code execution), fast and simple to implement. 'safetensors' also enables cross language and cross frameworks compatibility making it an ideal format for storing machine learning model weights.
  license_family: MIT
  license_file:
    - {{ environ["PREFIX"] }}/lib/R/share/licenses/MIT
    - LICENSE

extra:
  recipe-maintainers:
    - conda-forge/r
